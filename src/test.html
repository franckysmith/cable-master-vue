<!DOCTYPE html>
<html lang=en>
<head>
<meta charset=utf-8>
<title>Test Cable API</title>
</head>

<body>

<script type="module">

import { Api } from './js/api.js';

var apiUrl = 'api.php';

var api = new Api(apiUrl);

// To run a particular method, uncomment the respective code block, and comment out all others,
// then refresh the page and see the console in your browser
// Run methods one by one consecutively in this order as they are in code

//---- 'cable_get' ----

/*api.call('cable_get').then(function(response) {
  console.log('cable_get:');
  console.log(response);
}).catch(function(response) {
  console.log('cable_get:');
  console.log(response);
});*/

/*//---- 'cable_add' ----
 
var data = [
  {
    name:   'do48',
    type:   'microphone',
    total:  100
  },
  {
    name:   'rs232',
    type:   'speaker',
    total:  50
  }
];

api.call('cable_add', data).then(function(response) {
  console.log('cable_add:');
  console.log(response);
}).catch(function(response) {
  console.log('cable_add:');
  console.log(response);
});*/

/*//---- 'cable_update' ----

var data = [
  {
    cableid: 13,  // put here real cableid that were added via 'cable_add', see it in 'cable' table in phpmyadmin
    name:   'do50',
    type:   'electrical',
    total:  50
  },
  {
    cableid: 14,  // put here real cableid that were added via 'cable_add', see it in 'cable table in phpmyadmin
    name:   'rs434',
    type:   'microphone',
    total:  30
  }
];

api.call('cable_update', data).then(function(response) {
  console.log('cable_update:');
  console.log(response);
}).catch(function(response) {
  console.log('cable_update:');
  console.log(response);
});*/

//---- 'cable_delete' ----

/*// [ 13, 14 ] put here actual cable ids, see them in 'cable' table in phpmyadmin

api.call('cable_delete', [ 13, 14 ]).then(function(response) {
  console.log('cable_delete:');
  console.log(response);
}).catch(function(response) {
  console.log('cable_delete:');
  console.log(response);
});*/

/*//---- 'affair_get' ----

var searchby = {
  //tech_id: 3,
  name: 'Casino de Paris'
};

api.call('affair_get', searchby).then(function(response) {
  console.log('affair_get:');
  console.log(response);
}).catch(function(response) {
  console.log('affair_get:');
  console.log(response);
});*/

/*//---- 'affair_add' ----

var data = {
  tech_id:      32,
  tech_name:    'John Smith',
  name:         'Bolshoi Theater',
  prep_date:    '2021-02-15',
  prep_time:    'afternoon',
  receipt_date: '2021-02-17',
  return_date:  '2021-02-18',
  monitor:      true,
  stage:        true
};

api.call('affair_add', data).then(function(response) {
  console.log('affair_add:');
  console.log(response);
}).catch(function(response) {
  console.log('affair_add:');
  console.log(response);
});*/

/*//---- 'affair_update' ----

var data = {
  affairid:     5,  // put here actual affairid you want to update
  name:         'Crocus Hall',
  prep_time:    'morning'
};

api.call('affair_update', data).then(function(response) {
  console.log('affair_update:');
  console.log(response);
}).catch(function(response) {
  console.log('affair_update:');
  console.log(response);
});*/

/*//---- 'affair_delete' ----

var data = {
  affairid: 5  // put here actual affairid you want to delete
};

api.call('affair_delete', data).then(function(response) {
  console.log('affair_delete:');
  console.log(response);
}).catch(function(response) {
  console.log('affair_delete:');
  console.log(response);
});*/

//---- 'order_get' ----

api.call('order_get', { affairid: 3 }).then(response => {
  console.log('order_get:');
  console.log(response);
}).catch(response => {
  console.log('order_get:');
  console.log(response);
});

//---- 'order_set' ----

/*api.call('order_set', [
  {
    cableid:  4,
    affairid: 3,
    tech_id:  135,
    count:    50,
    spare_count: 25,
    done:     true,
    tfc1:     3,
    tfc2:     3,
    tfc3:     2
  },
  {
    cableid:  6,
    affairid: 3,
    tech_id:  135,
    count:    10,
    spare_count: 5
  },
]).catch(response => {
  console.log('order_set:');
  console.log(response);
});*/

//---- aggregateData(orders, cables) ----

/*import { isEmpty } from './js/lib/util.js';

const NO_ORDER = {
  isChecked:    false,
  count:        '',
  spare_count:  0,
  tfc1:         '',
  tfc2:         '',
  tfc3:         '',
  tfc4:         '',
  tfc5:         ''
}

function cables()
{
  return api.call('cable_get');
}

function orders(searchby)
{
  return api.call('order_get', searchby);
}

function aggregateData(orders, cables)
{
  return Promise.all([ orders, cables ]).then(([ orders, cables ]) => {
    
    let data = [];
    
    orders = new Map(orders.map(o => [ o.cableid, o ]));  // turn Array into Map of [ cableid, { order } ] items
    
    for(const { cableid, name, type, total, link, info } of cables) {
      // prepare cable
      let cable = { name, type, total, link, info };
      // prepare order
      let order = orders.get(cableid);
      if(order) {
        let { count, spare_count, tfc1, tfc2, tfc3, tfc4, tfc5 } = order;
        order = { isChecked: true, count, spare_count, tfc1, tfc2, tfc3, tfc4, tfc5 }; // avoid unneeded fields in order
      }
      else
        order = NO_ORDER;
        
      let line = { ...order, ...cable };
      data.push(line);
    }

    return data;
  });
}

aggregateData(orders({ affairid: 3 }), cables()).then(function(data) {
  console.log(data);
}).catch(function(error) {
  console.log(error);
});*/

</script>

</body>
</html>